<app-msg [MsgBoxId]="msgBoxId"></app-msg>

<app-floating-modal [floatingModalId]="addBranchFloatingModalId" title="Add Branch">
    <form [formGroup]="newBranchFrom" (ngSubmit)="createNewBranch()" class="w-full sm:w-80 flex flex-col gap-4">
        <app-input [control]="branchName" name="Branch Name" type="text" autocomplete="Name" placeholder="Branch Name"></app-input>
        <app-input [control]="branchCode" name="Branch Code" type="text" placeholder="Branch Code"></app-input>
        <button [disabled]="isCreatingNewBranch" type="submit"
            class="w-4/5 text-white py-2 sm:py-3 rounded bg-themeblue-900 w-full mt-2">
            <app-dot-wave-loader colorCode="#FFFFFF" class="flex justify-center items-center my-1 mt-1.5"
                *ngIf="isCreatingNewBranch ; else GetStartText" />
            <ng-template #GetStartText> Create Branch </ng-template>
        </button>
    </form>
</app-floating-modal>

<app-floating-modal [floatingModalId]="addBranchCSVFloatingModalId" title="Add Branch CSV">
   <app-upload-file></app-upload-file>
</app-floating-modal>

<main class="p-6">

    <app-page-heading [heading]="pageTitle" [navigations]="['Menu', pageTitle]"></app-page-heading>

    <div class="flex justify-between gap-4 w-full mb-4">

        <!-- Topbar Search -->
        <div class="md:flex items-center relative">
            <div class="absolute inset-y-0 start-0 flex items-center ps-3 pointer-events-none">
                <i class="fa-solid fa-magnifying-glass text-themeblue-900"></i>
            </div>
            <input type="search"
                class="form-input px-8 rounded-lg border-transparent focus:border-transparent bg-themeblue-100 text-themeblue-900"
                placeholder="Search..." [(ngModel)]="filterText" (input)="filterData($event)">
            <button type="button" class="absolute inset-y-0 end-0 flex items-center pe-3  text-themeblue-900">
                <i class="fa-solid fa-microphone"></i>
            </button>
        </div>

        <app-floating-dropdown [floatingDropdownId]="addLeadId">
            <button floating-dropdown-title (click)="openFloatingDropdown($event, addLeadId)"
                class="floating-dropdown-btn nav-link flex items-center gap-2.5 waves-effect px-3 py-5 h-10 w-10 rounded-lg bg-themeblue-100">
                <i class="floating-dropdown-btn fa-solid fa-plus fa-lg  text-themeblue-900"></i>
            </button>
            <div floating-dropdown-menu
                class="absolute top-11 z-50 transition-[margin,opacity] duration-900 mt-2 bg-white shadow-lg rounded-lg p-2 mr-5"
                style="right: -1.2rem;">
                <div (click)="openAddBranchForm($event)"
                    class="cursor-pointer w-40 flex items-center py-2 px-3 rounded-md text-sm text-gray-800 hover:bg-gray-500 hover:bg-themeblue-200">
                    Create Branches
                </div>
                <div (click)="openAddBranchCSVForm($event)"
                    class="cursor-pointer w-40 flex items-center py-2 px-3 rounded-md text-sm text-gray-800 hover:bg-gray-500 hover:bg-themeblue-200">
                    Import CSV
                </div>
            </div>
        </app-floating-dropdown>
    </div>
    <div class="grid">
        <div class="overflow-x-auto w-full rounded-lg">
            <div class="min-w-full inline-block align-middle rounded-lg">
                <div class="overflow-auto border rounded-lg shadow h-max max-h-[60vh]">
                    <table class="min-w-full whitespace-nowrap text-base divide-y divide-gray-200">
                        <thead class="text-grey-500">
                            <tr class="bg-themeblue-100 sticky top-0">
                                <th></th>
                                <th class="px-6 py-3">
                                    <input type="checkbox" id="AllOrgCheckbox" (click)="toggelAllUserSelection($event)"
                                        class="float-left form-checkbox rounded h-3 w-3 sm:h-4 sm:w-4 login-checkbox focus:outline-none">
                                </th>
                                <th class="px-6 py-3 ">
                                    <span class="float-left">Name</span>
                                    <app-floating-dropdown [floatingDropdownId]="branchNameDropDownId">
                                        <i floating-dropdown-title
                                            (click)="openFloatingDropdown($event, branchNameDropDownId)"
                                            class="fa-solid fa-filter float-right mt-1 floating-dropdown-btn"></i>
                                        <div floating-dropdown-menu
                                            class="absolute top-4 z-50 transition-[margin,opacity] duration-900 mt-2 bg-white shadow-lg rounded-lg p-2 mr-5 w-32"
                                            style="right: -1.2rem;">
                                            <div
                                                class="flex justify-between items-center py-2 px-3 rounded-md text-sm text-gray-500 hover:bg-themeblue-200">
                                                <p>ASC</p>
                                                <i class="fa-solid fa-arrow-up-a-z"></i>
                                            </div>
                                            <div
                                                class="flex justify-between items-center py-2 px-3 rounded-md text-sm text-gray-500 hover:bg-themeblue-200">
                                                <p>DSC</p>
                                                <i class="fa-solid fa-arrow-down-z-a"></i>
                                            </div>
                                        </div>
                                    </app-floating-dropdown>
                                </th>
                                <th class="px-6 py-3">
                                    <span class="float-left">Branch Code</span>
                                    <app-floating-dropdown [floatingDropdownId]="branchCodeDropDownId">
                                        <i floating-dropdown-title
                                            (click)="openFloatingDropdown($event, branchCodeDropDownId)"
                                            class="fa-solid fa-filter float-right mt-1 floating-dropdown-btn"></i>
                                        <div floating-dropdown-menu
                                            class="absolute top-4 z-50 transition-[margin,opacity] duration-900 mt-2 bg-white shadow-lg rounded-lg p-2 mr-5 w-32 "
                                            style="right: -1.2rem;">
                                            <div
                                                class="flex justify-between items-center  py-2 px-3 rounded-md text-sm text-gray-500 hover:bg-themeblue-200">
                                                <p>ASC</p>
                                                <i class="fa-solid fa-arrow-up-a-z"></i>
                                            </div>
                                            <div
                                                class="flex justify-between items-center py-2 px-3 rounded-md text-sm text-gray-500 hover:bg-themeblue-200">
                                                <p>DSC</p>
                                                <i class="fa-solid fa-arrow-down-z-a"></i>
                                            </div>
                                        </div>
                                    </app-floating-dropdown>
                                </th>
                                <th class="px-6 py-3">
                                    <span class="float-left">Create Date</span>
                                    <app-floating-dropdown [floatingDropdownId]="branchCreateDateDropDownId">
                                        <i floating-dropdown-title
                                            (click)="openFloatingDropdown($event, branchCreateDateDropDownId)"
                                            class="fa-solid fa-filter float-right mt-1 floating-dropdown-btn"></i>
                                        <div floating-dropdown-menu
                                            class="absolute top-4 z-50 transition-[margin,opacity] duration-900 mt-2 bg-white shadow-lg rounded-lg p-2 mr-5 w-32 "
                                            style="right: -1.2rem;">
                                            <div
                                                class="flex justify-between items-center  py-2 px-3 rounded-md text-sm text-gray-500 hover:bg-themeblue-200">
                                                <p>ASC</p>
                                                <i class="fa-solid fa-arrow-up-a-z"></i>
                                            </div>
                                            <div
                                                class="flex justify-between items-center py-2 px-3 rounded-md text-sm text-gray-500 hover:bg-themeblue-200">
                                                <p>DSC</p>
                                                <i class="fa-solid fa-arrow-down-z-a"></i>
                                            </div>
                                        </div>
                                    </app-floating-dropdown>
                                </th>
                            </tr>
                        </thead>
                        <tbody *ngIf="branchList != null && branchList != []; else loader "
                            class="divide-y divide-themeblue-100">
                            <tr *ngFor="let branch of filteredList" class="group hover:bg-themeblue-200">
                                <td class="pl-4 py-3">
                                    <div class="invisible group-hover:visible h-6 w-6 rounded-full bg-white flex justify-center items-center">
                                        <i
                                            class="fa-solid fa-ellipsis text-themeblue-900 fa-sm">
                                        </i>
                                    </div>
                                </td>
                                <td class="px-6 py-3">
                                    <input type="checkbox" [checked]="selectedUserList.includes(branch)"
                                        (click)="toggelUserSelect($event, branch)"
                                        class="form-checkbox rounded h-3 w-3 sm:h-4 sm:w-4 login-checkbox focus:outline-none">
                                </td>
                                <td class="px-6 py-3">{{branch.branchName}}</td>
                                <td class="px-6 py-3">
                                    {{branch.branchCode}}
                                </td>
                                <td class="px-6 py-3">
                                    {{branch.createDate | date:'MMM dd, yyyy'}}
                                </td>
                            </tr>
                        </tbody>
                        <ng-template #loader>
                            <app-dot-wave-loader colorCode="#11153e"></app-dot-wave-loader>
                        </ng-template>
                    </table>
                </div>
            </div>
        </div>
    </div>

</main>