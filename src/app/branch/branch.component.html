<app-msg [MsgBoxId]="msgBoxId"></app-msg>
<app-msg [MsgBoxId]="uploadBoxId"></app-msg>

<app-floating-modal [floatingModalId]="addBranchFloatingModalId" title="Add Branch">
  <form [formGroup]="newBranchFrom" (ngSubmit)="createNewBranch()" class="xs:w-80 w-full flex flex-col gap-4">
    <app-input [control]="branchName" name="Branch Name" type="text" autocomplete="Name"
      placeholder="Branch Name"></app-input>
    <app-input [control]="branchCode" name="Branch Code" type="text" placeholder="Branch Code"></app-input>
    <button [disabled]="isCreatingNewBranch" type="submit"
      class="w-4/5 text-white py-2 sm:py-3 rounded bg-themeblue-900 w-full mt-2">
      <app-dot-wave-loader colorCode="#FFFFFF" class="flex justify-center items-center my-1 mt-1.5"
        *ngIf="isCreatingNewBranch ; else GetStartText" />
      <ng-template #GetStartText> Create Branch </ng-template>
    </button>
  </form>
</app-floating-modal>

<app-floating-modal [floatingModalId]="addBranchCSVFloatingModalId" title="Add Branch CSV">
  <app-upload-file #uploadFileComponent [mappingFieldsInput]="mappingFields.BranchFields"
    (onFinalListGenerated)="createBranchRange($event)"></app-upload-file>
</app-floating-modal>

<main class="p-6">

  <app-page-heading [heading]="pageTitle" [navigations]="['Menu', pageTitle]"></app-page-heading>

  <div class="flex justify-between gap-4 w-full mb-4">

    <div class="flex justify-center items-center gap-4">
      <!-- Topbar Search -->
      <div class="md:flex items-center relative">
        <div class="absolute inset-y-0 start-0 flex items-center ps-3 pointer-events-none">
          <i class="fa-solid fa-magnifying-glass text-themeblue-900"></i>
        </div>
        <input type="search"
          class="form-input px-8 rounded-lg border-transparent focus:border-transparent bg-themeblue-100 text-themeblue-900"
          placeholder="Search..." [(ngModel)]="filterText" (input)="filterData($event)">
        <button type="button" class="absolute inset-y-0 end-0 flex items-center pe-3  text-themeblue-900">
          <i class="fa-solid fa-microphone"></i>
        </button>
      </div>
    </div>

    <div class="flex justify-center items-center gap-4">
      <!-- Action Button -->
      <app-floating-dropdown *ngIf="selectedUserList.length != 0" [floatingDropdownId]="branchActionDropdownId"
        class="float-left">
        <button floating-dropdown-title (click)="openFloatingDropdown($event, branchActionDropdownId)"
          class="floating-dropdown-btn relative text-base rounded-lg w-32 px-2.5 py-1.5 border-2 flex justify-between items-center focus:border-grey-200 bg-white">
          Actions <i class="fa-solid fa-caret-down floating-dropdown-btn"></i>
        </button>
        <div floating-dropdown-menu
          class="absolute top-8 z-50 transition-[margin,opacity] duration-900 mt-2 bg-white border-2 border-grey-400 rounded-lg p-2 mr-5 w-fit min-w-32 sm:left-0 right-0"
          style="right: -1.2rem;">
          <div (click)="deleteSeletedRecords()"
            class="cursor-pointer flex items-center py-2 px-3 rounded-md text-sm text-gray-500 hover:bg-themeblue-200 whitespace-nowrap">
            Delete
          </div>
          <div
            class="cursor-pointer flex items-center py-2 px-3 rounded-md text-sm text-gray-500 hover:bg-themeblue-200 whitespace-nowrap">
            Assign
          </div>
          <div
            class="cursor-pointer flex items-center py-2 px-3 rounded-md text-sm text-gray-500 hover:bg-themeblue-200 whitespace-nowrap">
            Create Task
          </div>
        </div>
      </app-floating-dropdown>

      <!-- ADD Button -->
      <app-floating-dropdown [floatingDropdownId]="addLeadId">
        <button floating-dropdown-title (click)="openFloatingDropdown($event, addLeadId)"
          class="floating-dropdown-btn nav-link flex items-center gap-2.5 waves-effect px-3 py-5 h-10 w-10 rounded-lg bg-themeblue-100">
          <i class="floating-dropdown-btn fa-solid fa-plus fa-lg  text-themeblue-900"></i>
        </button>
        <div floating-dropdown-menu
          class="absolute top-11 z-50 transition-[margin,opacity] duration-900 mt-2 bg-white shadow-lg rounded-lg p-2 mr-5"
          style="right: -1.2rem;">
          <div (click)="openAddBranchForm($event)"
            class="cursor-pointer w-40 flex items-center py-2 px-3 rounded-md text-sm text-gray-800 hover:bg-gray-500 hover:bg-themeblue-200">
            Create Branches
          </div>
          <div (click)="openAddBranchCSVForm($event)"
            class="cursor-pointer w-40 flex items-center py-2 px-3 rounded-md text-sm text-gray-800 hover:bg-gray-500 hover:bg-themeblue-200">
            Import CSV
          </div>
        </div>
      </app-floating-dropdown>
    </div>
  </div>
  <div class="grid">
    <div class="overflow-x-auto w-full rounded-lg">
      <div class="min-w-full inline-block align-middle rounded-lg">
        <div class="overflow-auto border rounded-lg shadow h-max max-h-[55vh]">
          <table class="min-w-full whitespace-nowrap text-base divide-y divide-gray-200">
            <thead class="text-grey-500">
              <tr class="bg-themeblue-100 sticky top-0">
                <th></th>
                <th class="px-6 py-3">
                  <input type="checkbox" id="AllOrgCheckbox" (click)="toggelAllUserSelection($event)"
                    class="float-left form-checkbox rounded h-3 w-3 sm:h-4 sm:w-4 login-checkbox focus:outline-none">
                </th>
                <th class="px-6 py-3 ">
                  <span class="float-left">Name</span>
                  <app-floating-dropdown [floatingDropdownId]="branchNameDropDownId">
                    <i floating-dropdown-title (click)="openFloatingDropdown($event, branchNameDropDownId)"
                      class="fa-solid fa-filter float-right mt-1 floating-dropdown-btn"></i>
                    <div floating-dropdown-menu
                      class="absolute top-4 z-50 transition-[margin,opacity] duration-900 mt-2 bg-white shadow-lg rounded-lg p-2 mr-5 w-32"
                      style="right: -1.2rem;">
                      <div
                        class="flex justify-between items-center py-2 px-3 rounded-md text-sm text-gray-500 hover:bg-themeblue-200">
                        <p>ASC</p>
                        <i class="fa-solid fa-arrow-up-a-z"></i>
                      </div>
                      <div
                        class="flex justify-between items-center py-2 px-3 rounded-md text-sm text-gray-500 hover:bg-themeblue-200">
                        <p>DSC</p>
                        <i class="fa-solid fa-arrow-down-z-a"></i>
                      </div>
                    </div>
                  </app-floating-dropdown>
                </th>
                <th class="px-6 py-3">
                  <span class="float-left">Branch Code</span>
                  <app-floating-dropdown [floatingDropdownId]="branchCodeDropDownId">
                    <i floating-dropdown-title (click)="openFloatingDropdown($event, branchCodeDropDownId)"
                      class="fa-solid fa-filter float-right mt-1 floating-dropdown-btn"></i>
                    <div floating-dropdown-menu
                      class="absolute top-4 z-50 transition-[margin,opacity] duration-900 mt-2 bg-white shadow-lg rounded-lg p-2 mr-5 w-32 "
                      style="right: -1.2rem;">
                      <div
                        class="flex justify-between items-center  py-2 px-3 rounded-md text-sm text-gray-500 hover:bg-themeblue-200">
                        <p>ASC</p>
                        <i class="fa-solid fa-arrow-up-a-z"></i>
                      </div>
                      <div
                        class="flex justify-between items-center py-2 px-3 rounded-md text-sm text-gray-500 hover:bg-themeblue-200">
                        <p>DSC</p>
                        <i class="fa-solid fa-arrow-down-z-a"></i>
                      </div>
                    </div>
                  </app-floating-dropdown>
                </th>
                <th class="px-6 py-3">
                  <span class="float-left">Create Date</span>
                  <app-floating-dropdown [floatingDropdownId]="branchCreateDateDropDownId">
                    <i floating-dropdown-title (click)="openFloatingDropdown($event, branchCreateDateDropDownId)"
                      class="fa-solid fa-filter float-right mt-1 floating-dropdown-btn"></i>
                    <div floating-dropdown-menu
                      class="absolute top-4 z-50 transition-[margin,opacity] duration-900 mt-2 bg-white shadow-lg rounded-lg p-2 mr-5 w-32 "
                      style="right: -1.2rem;">
                      <div
                        class="flex justify-between items-center  py-2 px-3 rounded-md text-sm text-gray-500 hover:bg-themeblue-200">
                        <p>ASC</p>
                        <i class="fa-solid fa-arrow-up-a-z"></i>
                      </div>
                      <div
                        class="flex justify-between items-center py-2 px-3 rounded-md text-sm text-gray-500 hover:bg-themeblue-200">
                        <p>DSC</p>
                        <i class="fa-solid fa-arrow-down-z-a"></i>
                      </div>
                    </div>
                  </app-floating-dropdown>
                </th>
              </tr>
            </thead>
            <tbody *ngIf="branchList != null && branchList != []; else loader " class="divide-y divide-themeblue-100">
              <tr *ngFor="let branch of filteredList" class="group hover:bg-themeblue-200">
                <td class="pl-4 py-3">
                  <div
                    class="invisible group-hover:visible h-6 w-6 rounded-full bg-white flex justify-center items-center">
                    <i class="fa-solid fa-ellipsis text-themeblue-900 fa-sm">
                    </i>
                  </div>
                </td>
                <td class="px-6 py-3">
                  <input type="checkbox" [checked]="selectedUserList.includes(branch)"
                    (click)="toggelUserSelect($event, branch)"
                    class="form-checkbox rounded h-3 w-3 sm:h-4 sm:w-4 login-checkbox focus:outline-none">
                </td>
                <td class="px-6 py-3">{{branch.branchName}}</td>
                <td class="px-6 py-3">
                  {{branch.branchCode}}
                </td>
                <td class="px-6 py-3">
                  {{branch.createDate | date:'MMM dd, yyyy'}}
                </td>
              </tr>
            </tbody>
            <ng-template #loader>
              <app-dot-wave-loader colorCode="#11153e"></app-dot-wave-loader>
            </ng-template>
          </table>
        </div>
      </div>
    </div>
  </div>
  <div class="flex items-center justify-between w-full mt-3">
    <div class="text-base font-normal">
      <p *ngIf="selectedUserList.length == 0; else selectedRecordCount">Total Records : <span
          class="font-semibold">{{totalRecords}}</span></p>
      <ng-template #selectedRecordCount>
        <div class="flex justify-center align-center gap-4">
          <p> <span class="font-semibold">{{selectedUserList.length}} </span>&nbsp;Records Seleted</p>
          <button (click)="clearSelectedUser($event)" class="border-b-2 hover:border-gray-400">Clear</button>
        </div>
      </ng-template>
    </div>
    <div class="flex items-center">
      <div class="w-full flex items-center">
        <label class="text-base text-gray-500">Items per page
        </label>
          <app-floating-dropdown floatingDropdownId="branchRecordPerPageId">
            <button floating-dropdown-title (click)="openFloatingDropdown($event, 'branchRecordPerPageId')"
              class="floating-dropdown-btn border-grey-400 border-2 text-themeblue-900 py-1 w-16 px-2 ml-2 mr-5 rounded flex justify-between items-center focus:border-grey-400">
              {{recordPerPage}} <i class="fa-solid fa-caret-up text-themeblue-900 floating-dropdown-btn"></i>
            </button>
            <div floating-dropdown-menu
              class="absolute bottom-9 z-50 transition-[margin,opacity] duration-900 mt-2 bg-white border-2 border-grey-400 rounded-lg p-2 mr-5 w-fit right-0 min-w-16"
              >
              <div *ngFor="let opt of recordPerPageOptions" (click)="changeRecordPerPage(opt)"
                [ngClass]="{'bg-themeblue-200': recordPerPage == opt}"
                class="cursor-pointer flex items-center py-2 px-3 rounded-md text-sm text-gray-800 hover:bg-gray-500 hover:bg-themeblue-200 whitespace-nowrap">
                {{opt}}
              </div>
            </div>
          </app-floating-dropdown>

      </div>
      <div *ngIf="!(this.pageNoOptions.length > 7); else pagination" class="">
        <ul class="flex h-8 text-sm">
          <li>
            <a (click)="onPrevious(pageNo)"
              class="flex items-center px-3 h-8 ms-0 leading-tight text-gray-500 bg-white border border-e-0 border-gray-300 rounded-s-lg hover:bg-gray-100 hover:text-gray-700">
              <span class="sr-only">Previous</span>
              <svg class="w-2.5 h-2.5 rtl:rotate-180" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none"
                viewBox="0 0 6 10">
                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M5 1 1 5l4 4" />
              </svg>
            </a>
          </li>
          <div *ngFor="let pageNoOpt of pageNoOptions">
            <li>
              <div (click)="changePageNo(pageNoOpt)"
                [ngClass]="{'bg-themeblue-400 text-white':pageNoOpt==pageNo, 'hover:bg-themeblue-200 hover:text-themeblue-900':pageNoOpt!=pageNo}"
                class="flex items-center justify-center px-3 h-8 leading-tight text-gray-500 border border-gray-300  cursor-pointer">
                {{pageNoOpt}}</div>
            </li>
          </div>
          <li>
            <a (click)="onNext(pageNo)"
              class="flex items-center justify-center px-3 h-8 leading-tight text-gray-500 bg-white border border-gray-300 rounded-e-lg hover:bg-gray-100 hover:text-gray-700">
              <span class="sr-only">Next</span>
              <svg class="w-2.5 h-2.5 rtl:rotate-180" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none"
                viewBox="0 0 6 10">
                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="m1 9 4-4-4-4" />
              </svg>
            </a>
          </li>
        </ul>
      </div>

      <ng-template #pagination>

        <ul class="flex h-8 text-sm">
          <li>
            <a (click)="onPrevious(pageNo)"
              class="flex items-center px-3 h-8 ms-0 leading-tight text-gray-500 bg-white border border-e-0 border-gray-300 rounded-s-lg hover:bg-gray-100 hover:text-gray-700">
              <span class="sr-only">Previous</span>
              <svg class="w-2.5 h-2.5 rtl:rotate-180" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none"
                viewBox="0 0 6 10">
                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M5 1 1 5l4 4" />
              </svg>
            </a>
          </li>
          <li>
            <div
              class="flex items-center justify-center px-3 h-8 leading-tight text-gray-500 border border-gray-300  cursor-pointer">
              •••</div>
          </li>
          <div *ngFor="let pageNoOpt of pageNoOptions">
            <li>
              <div (click)="changePageNo(pageNoOpt)"
                [ngClass]="{'bg-themeblue-400 text-white':pageNoOpt==pageNo, 'hover:bg-themeblue-200 hover:text-themeblue-900':pageNoOpt!=pageNo}"
                class="flex items-center justify-center px-3 h-8 leading-tight text-gray-500 border border-gray-300  cursor-pointer">
                {{pageNoOpt}}</div>
            </li>
          </div>
          <li>
            <div
              class="flex items-center justify-center px-3 h-8 leading-tight text-gray-500 border border-gray-300  cursor-pointer">
              •••</div>
          </li>
          <li>
            <a (click)="onNext(pageNo)"
              class="flex items-center justify-center px-3 h-8 leading-tight text-gray-500 bg-white border border-gray-300 rounded-e-lg hover:bg-gray-100 hover:text-gray-700">
              <span class="sr-only">Next</span>
              <svg class="w-2.5 h-2.5 rtl:rotate-180" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none"
                viewBox="0 0 6 10">
                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="m1 9 4-4-4-4" />
              </svg>
            </a>
          </li>
        </ul>
      </ng-template>
    </div>
  </div>

</main>
